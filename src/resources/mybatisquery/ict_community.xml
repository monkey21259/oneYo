<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
          "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="main.ict.community.dao.CommunityDAO">

<!-- 글등록 -->
  <insert id="communityInsert" parameterType="communityvo">
  	INSERT INTO ICT_COMMUNITY(	  CNUM
						  		, CSUBJECT
						  		, CCONTENT
						  		, CPHOTO
						  		, MNUM
						  		, DELETEYN
						  		, INSERTDATE
						  		, UPDATEDATE
						  	 )
					  VALUES(
		   				    #{cnum}
						  , #{csubject}
						  , #{ccontent}
						  , #{cphoto}
						  , #{mnum}
						  , 'Y'
						  , SYSDATE
						  , SYSDATE
						    )
  		
  </insert>
  
<!-- 전체조회 -->
	<select id="communitySelectAll" resultType="communityvo"> 
		SELECT * FROM(
			SELECT	  ROW_NUMBER() OVER (ORDER BY A.CNUM)     AS      COMMUNITYNUM
                    , A.CNUM		 AS 	CNUM
					, A.CSUBJECT  	 AS 	CSUBJECT
					, A.CCONTENT 	 AS 	CCONTENT
					, A.CPHOTO 		 AS 	CPHOTO
					, A.WARNING 	 AS 	WARNING
					, B.MNUM 		 AS 	MNUM
		       		, B.MNICK        AS 	MNICK
					, A.CHIT 	     AS 	CHIT
					, A.DELETEYN 	 AS 	DELETEYN
					, TO_CHAR(TO_DATE(A.INSERTDATE),'YYYY-MM-DD') AS INSERTDATE
					, TO_CHAR(TO_DATE(A.UPDATEDATE),'YYYY-MM-DD') AS UPDATEDATE
					,CEIL(ROW_NUMBER() OVER(ORDER BY CNUM DESC) / #{pageSize}) pageSize
					, COUNT(A.CNUM) OVER() AS totalCount
			FROM  "ORCLICT00"."ICT_COMMUNITY" A
		         ,"ORCLICT00"."ICT_MEMBER"    B
			WHERE    A.MNUM = B.MNUM
			AND      A.DELETEYN = 'Y'
			AND      B.DELETEYN = 'Y'
			ORDER BY A.CNUM DESC
		) WHERE pageSize = #{curPage}
           ORDER BY COMMUNITYNUM DESC
        
	</select>

<!-- 게시글 조회  -->	
	<select id="communitySelect" parameterType="communityvo" resultType="communityvo">
		SELECT	  A.CNUM			 AS 	CNUM
					, A.CSUBJECT  	 AS 	CSUBJECT
					, A.CCONTENT 	 AS 	CCONTENT
					, A.CPHOTO 		 AS 	CPHOTO
					, A.WARNING 	 AS 	WARNING
					, B.MNUM 		 AS 	MNUM
		       		, B.MNICK        AS 	MNICK
					, A.CHIT 	     AS 	CHIT
					, A.DELETEYN 	 AS 	DELETEYN
					, TO_CHAR(TO_DATE(A.INSERTDATE),'YYYY-MM-DD') AS INSERTDATE
					, TO_CHAR(TO_DATE(A.UPDATEDATE),'YYYY-MM-DD') AS UPDATEDATE
			FROM  "ORCLICT00"."ICT_COMMUNITY" A
		         ,"ORCLICT00"."ICT_MEMBER"    B
			WHERE    A.MNUM = B.MNUM
			AND		A.CNUM = #{cnum }
			AND      A.DELETEYN = 'Y'
			AND      B.DELETEYN = 'Y'
			
	</select>
	
<!-- 수정 -->	
	
</mapper>     

